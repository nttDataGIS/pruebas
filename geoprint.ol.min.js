!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){t.exports='<div class="m-control m-geoprint-container">\r\n    \x3c!-- TITLE --\x3e\r\n    <div class="title">Impresión del mapa</div>\r\n    \x3c!-- FORM --\x3e\r\n    <div class="form">\r\n        \x3c!-- title --\x3e\r\n        <div class="titulo">\r\n            <input type="text" title="Titulo" placeholder="Título">\r\n        </div>\r\n        \x3c!-- description --\x3e\r\n        <div class="subtitulo">\r\n            <input type="text" title="Subtítulo" placeholder="Subtítulo">\r\n            \x3c!--<textarea placeholder="Descripción"></textarea>--\x3e\r\n        </div>\r\n        \x3c!-- expediente --\x3e\r\n        <div class="expediente">\r\n            <input type="text" title="Expediente" placeholder="Expediente">\r\n        </div>\r\n        \x3c!-- localizacion --\x3e\r\n        <div class="localizacion">\r\n            <input type="text" title="Localización" placeholder="Localización">\r\n        </div>\r\n        \x3c!-- superficie --\x3e\r\n        <div class="superficie">\r\n            <input type="text" title="Superficie" placeholder="Superficie">\r\n        </div>\r\n        <hr style="margin:10px;height:1px;border-width:0;color:gray;background-color:gray">\r\n        <div class="firmantesCargos">\r\n            \x3c!-- firmantes --\x3e\r\n            <div class="firmantes">\r\n                <div class="firmante1">\r\n                    <input type="text" class="firmCargo" title="{{labelFirmante1}}" placeholder="{{labelFirmante1}}"\r\n                        value="{{firmante1}}">\r\n                </div>\r\n                <div class="firmante2">\r\n                    <input type="text" class="firmCargo" title="{{labelFirmante2}}" placeholder="{{labelFirmante2}}"\r\n                        value="{{firmante2}}">\r\n                </div>\r\n                <div class="firmante3">\r\n                    <input type="text" class="firmCargo" title="{{labelFirmante3}}" placeholder="{{labelFirmante3}}"\r\n                        value="{{firmante3}}">\r\n                </div>\r\n                <div class="firmante4">\r\n                    <input type="text" class="firmCargo" title="{{labelFirmante4}}" placeholder="{{labelFirmante4}}"\r\n                        value="{{firmante4}}">\r\n                </div>\r\n            </div>\r\n            \x3c!-- cargos --\x3e\r\n            <div class="cargos">\r\n                <div class="cargo1">\r\n                    <input type="text" class="firmCargo" title="{{labelCargo1}}" placeholder="{{labelCargo1}}"\r\n                        value="{{cargo1}}">\r\n                </div>\r\n                <div class="cargo2">\r\n                    <input type="text" class="firmCargo" title="{{labelCargo2}}" placeholder="{{labelCargo2}}"\r\n                        value="{{cargo2}}">\r\n                </div>\r\n                <div class="cargo3">\r\n                    <input type="text" class="firmCargo" title="{{labelCargo3}}" placeholder="{{labelCargo3}}"\r\n                        value="{{cargo3}}">\r\n                </div>\r\n                <div class="cargo4">\r\n                    <input type="text" class="firmCargo" title="{{labelCargo4}}" placeholder="{{labelCargo4}}"\r\n                        value="{{cargo4}}">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- separador --\x3e\r\n        <hr style="margin:10px;height:1px;border-width:0;color:gray;background-color:gray">\r\n        \x3c!-- layout --\x3e\r\n        <div class="layout">\r\n            <label>Plantilla </label>\r\n            <select>\r\n                {{#each layouts}}\r\n                <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\r\n                {{/each}}\r\n            </select>\r\n        </div>\r\n        \x3c!-- DPI --\x3e\r\n        <div class="dpi">\r\n            <label>DPI </label>\r\n            <select>\r\n                {{#each dpis}}\r\n                <option value="{{value}}" {{#if default}} selected{{/if}}>{{value}}</option>\r\n                {{/each}}\r\n            </select>\r\n        </div>\r\n        \x3c!-- format --\x3e\r\n        <div class="format">\r\n            <label>Formato </label>\r\n            <select>\r\n                {{#each format}}\r\n                <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\r\n                {{/each}}\r\n            </select>\r\n        </div>\r\n        \x3c!-- force scale --\x3e\r\n        <div class="forcescale">\r\n            <label>Forzar escala </label>\r\n            <input type="checkbox" {{#if forceScale}} checked{{/if}}>\r\n        </div>\r\n        \x3c!-- text wrap --\x3e\r\n        <div class="textwrap">\r\n            <label>% Ajuste texto</label>\r\n            <input id=\'inputRange\' type="range" min="0" max="1" step="0.1" value={{textWrap}}>\r\n            <div id=\'label\'>{{textWrap}}</div>\r\n        </div>\r\n    </div>\r\n    \x3c!-- capas leyenda --\x3e    \r\n    <div class="capasLeyenda">      \r\n    <div class="multiselect" id="multiSel">\r\n    </div></div>\r\n    \x3c!-- buttons --\x3e\r\n    <div class="button">\r\n        <button class="print"><i class="g-cartografia-impresora"></i> Imprimir</button>\r\n        <button class="remove"><i class="g-cartografia-papelera"></i> Borrar</button>\r\n        <button class="cancel"><i class="g-cartografia-cancelar"></i> Cancelar impresión</button>\r\n    </div>\r\n    \x3c!-- queue --\x3e\r\n    <div class="queue">\r\n        <div class="title">Descargar</div>\r\n        <ul class="queue-container"></ul>\r\n    </div>\r\n    \x3c!-- minimize button --\x3e\r\n    <div class="minimize" title="Minimizar el control de impresión"></div>\r\n</div>'},function(t){t.exports=JSON.parse('{"url":{"name":"Geoprint","separator":"*"},"constructor":"M.plugin.Geoprint","parameters":[],"files":{"ol":{"scripts":["geoprint.ol.min.js"],"styles":["geoprint.ol.min.css"]}},"metadata":{"uuid_plugin":"90e3e5e1-3b5a-4ddc-99a2-75bd6a7c6f2d","uuid_version_plugin":"691f4a32-b0f7-11ec-b909-0242ac120002","version_ficha_metadatos":"","name":"Geoprint","description":"Description of the plugin","text":"A full text about plugin","version":"1.1.0","date":"","author":"","org":"","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","buttons":[{"title":"","description":"","querySelector":""},{"title":"","description":"","querySelector":""}],"dependencies":{"modules":["",""],"plugins":[{"uuid":"","name":""}],"services":[{"name":"","description":""}]}}}')},function(t,e,i){},function(t,e,i){"use strict";i.r(e);i(2);function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=o(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function o(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=p(t);if(e){var r=p(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function c(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(c,M.impl.Control);var e,i,n,o=u(c);function c(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,c),(t=o.call(this)).facadeMap_=null,t.additionalOptsLabel_={},t.labeling_=e.labeling,M.utils.isNullOrEmpty(t.labeling_)?(t.additionalOptsLabel_.conflictResolution="false",t.additionalOptsLabel_.goodnessOfFit=.9):(M.utils.isNullOrEmpty(t.labeling_.allowOverruns)||(t.additionalOptsLabel_.allowOverruns=t.labeling_.allowOverruns),M.utils.isNullOrEmpty(t.labeling_.autoWrap)||(t.additionalOptsLabel_.autoWrap=t.labeling_.autoWrap),M.utils.isNullOrEmpty(t.labeling_.conflictResolution)?t.additionalOptsLabel_.conflictResolution="false":t.additionalOptsLabel_.conflictResolution=t.labeling_.conflictResolution,M.utils.isNullOrEmpty(t.labeling_.followLine)||(t.additionalOptsLabel_.followLine=t.labeling_.followLine),M.utils.isNullOrEmpty(t.labeling_.goodnessOfFit)?t.additionalOptsLabel_.goodnessOfFit=.9:t.additionalOptsLabel_.goodnessOfFit=t.labeling_.goodnessOfFit,M.utils.isNullOrEmpty(t.labeling_.group)||(t.additionalOptsLabel_.group=t.labeling_.group),M.utils.isNullOrEmpty(t.labeling_.maxDisplacement)||(t.additionalOptsLabel_.maxDisplacement=t.labeling_.maxDisplacement),M.utils.isNullOrEmpty(t.labeling_.spaceAround)||(t.additionalOptsLabel_.spaceAround=t.labeling_.spaceAround)),t}return e=c,(i=[{key:"addTo",value:function(t,e){this.facadeMap_=t,a(p(c.prototype),"addTo",this).call(this,t,e)}},{key:"encodeLayer",value:function(t){var e=this;return new Promise((function(i,n){t.type===M.layer.type.WMC||(t.type===M.layer.type.KML?i(e.encodeKML(t)):t.type===M.layer.type.WMS?i(e.encodeWMS(t)):t.type===M.layer.type.WFS||t.type===M.layer.type.GeoJSON?i(e.encodeWFS(t)):t.type===M.layer.type.WMTS?e.encodeWMTS(t).then((function(t){i(t)})):t.type===M.layer.type.MBtiles||(t.type===M.layer.type.OSM?i(e.encodeOSM(t)):t.type===M.layer.type.Mapbox?i(e.encodeMapbox(t)):(M.utils.isNullOrEmpty(t.type)&&M.layer.Vector,i(e.encodeWFS(t)))))}))}},{key:"encodeLegend",value:function(t){var e=null;if(t.displayInLayerSwitcher){e={classes:[]};var i=new RegExp(".*".concat(M.Layer.LEGEND_DEFAULT,"$")),n=new RegExp(".*".concat(M.Layer.LEGEND_ERROR,"$")),r=t.getLegendURL();M.utils.isNullOrEmpty(r)||i.test(r)||n.test(r)||(e.classes[0]={name:t.name,icons:[t.getLegendURL()]},t instanceof M.layer.Vector&&delete e.classes[0].icons)}return e}},{key:"encodeKML",value:function(t){var e=this,i=t.getImpl().getOL3Layer(),n=i.getSource().getFeatures(),r=t.name,l=i.getOpacity(),a=new ol.format.GeoJSON,o=this.facadeMap_.getBbox();o=[o.x.min,o.y.min,o.x.max,o.y.max];var s,u,c=this.facadeMap_.getMapImpl().getView().getResolution(),p=[],f=1,d=1,m="",y={},g={},h=1;return n.forEach((function(t){var i=t.getGeometry(),n=t.get("styleUrl");M.utils.isNullOrEmpty(n)||(n=n.replace("#",""));var r=t.getStyle();if(!M.utils.isNullOrEmpty(r)){var l;try{l=r(t,c),Array.isArray(l)&&(l=l[0])}catch(e){l=r.call(t,c)[0]}if(!M.utils.isNullOrEmpty(l)){var v,b=l.getImage(),O=b.getImageSize();M.utils.isNullOrEmpty(O)&&(O=[64,64]),v="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":t.getGeometry().getType().toLowerCase();var _,E=l.getStroke(),x={type:v,id:n,externalGraphic:b.getSrc(),graphicHeight:O[0],graphicWidth:O[1],graphicOpacity:b.getOpacity(),strokeWidth:E?E.getWidth():1},S=l.getText&&l.getText();if(M.utils.isNullOrEmpty(S)||((_={type:"text",label:M.utils.isNullOrEmpty(S.getText())?t.get("name"):S.getText(),fontColor:M.utils.isNullOrEmpty(S.getFill())?"":M.utils.rgbToHex(M.utils.isArray(S.getFill().getColor())?"rgba(".concat(S.getFill().getColor().toString(),")"):S.getFill().getColor()),fontSize:"11px",fontFamily:"Helvetica, sans-serif",fontWeight:"bold",conflictResolution:e.additionalOptsLabel_.conflictResolution,labelAlign:S.getTextAlign(),labelXOffset:S.getOffsetX(),labelYOffset:S.getOffsetY(),labelOutlineColor:M.utils.isNullOrEmpty(S.getStroke())?"":M.utils.rgbToHex(M.utils.isArray(S.getStroke().getColor())?"rgba(".concat(S.getStroke().getColor().toString(),")"):S.getStroke().getColor()),labelOutlineWidth:M.utils.isNullOrEmpty(S.getStroke())?"":S.getStroke().getWidth()}).fontColor=_.fontColor.slice(0,7),_.labelOutlineColor=_.labelOutlineColor.slice(0,7),_=e.addAdditionalLabelOptions(_)),s="draw".concat(h),!M.utils.isNullOrEmpty(i)&&i.intersectsExtent(o)||!M.utils.isNullOrEmpty(S)){var N=JSON.stringify(x),L=JSON.stringify(_),C=y[N],T=g[L];if(M.utils.isUndefined(C)||M.utils.isUndefined(T)){var w=[],F=0;if(!M.utils.isNullOrEmpty(i)&&i.intersectsExtent(o)&&M.utils.isUndefined(C)&&(C=d,y[N]=C,F=1,w.push(N),d+=1,h+=1),!M.utils.isNullOrEmpty(S)&&M.utils.isUndefined(T)&&(T=f,g[L]=T,w.push(L),f+=1,0===F&&(h+=1,w.push(N))),void 0===C&&(C=0),void 0===T&&(T=0),u="\"[_gx_style ='".concat(C+T,"']\""),!M.utils.isNullOrEmpty(w)){var P=" ".concat(u,':{"symbolizers": [').concat(w,"]}");m+=""!==m?",".concat(P):"{".concat(P,',"version":"2"')}}var R=a.writeFeatureObject(t);R.properties={_gx_style:C+T,name:s},p.push(R)}}}}),this),{type:"Vector",style:m=""!==m?JSON.parse(m.concat("}")):{"*":{symbolizers:[]},version:"2"},geoJson:{type:"FeatureCollection",features:p},name:r,opacity:l}}},{key:"encodeWMS",value:function(t){var e=null,i=t.getImpl().getOL3Layer(),n=t.url,r=i.getOpacity(),l=i.getSource().getParams(),a=[l.LAYERS],o=l.FORMAT,s=[l.STYLES];if(e={baseURL:n,opacity:r,type:"WMS",layers:a.join(",").split(","),imageFormat:o||"image/jpeg",styles:s.join(",").split(",")},t._updateNoCache){t._updateNoCache();var u=t.getNoCacheName(),c=t.getNoCacheUrl();M.utils.isNullOrEmpty(u)||M.utils.isNullOrEmpty(c)||(e.layers=[u],e.baseURL=c)}else{var p=t.getNoChacheName(),f=t.getNoChacheUrl();M.utils.isNullOrEmpty(p)||M.utils.isNullOrEmpty(f)||(e.layers=[p],e.baseURL=f)}return e.customParams={},Object.keys(l).forEach((function(t){-1!=="iswmc,transparent".indexOf(t.toLowerCase())&&(e.customParams[t]=l[t])})),e}},{key:"encodeWFS",value:function(t){var e=this,i=null,n=!0;if((t.getStyle()instanceof M.style.Chart||t.getStyle()instanceof M.style.Cluster&&t.getStyle().getOldStyle()instanceof M.style.Chart)&&(n=!1),n){var r=this.facadeMap_.getProjection(),l=t.getImpl().getOL3Layer(),a=null;a=t.type===M.layer.type.MVT?t.getFeatures():l.getSource().getFeatures();var o=t.name,s=l.getOpacity(),u=l.getStyle(),c=new ol.format.GeoJSON,p=this.facadeMap_.getBbox();p=[p.x.min,p.y.min,p.x.max,p.y.max];var f,d,m=this.facadeMap_.getMapImpl().getView().getResolution(),y=[],g=1,h=1,v=1,b="",O={},_={};a.forEach((function(i){var n,l=i.getGeometry(),a=i.getStyle();M.utils.isNullOrEmpty(a)?M.utils.isNullOrEmpty(u)||(n=u):n=a,n instanceof Function&&(n=n.call(n,i,m));var o=null;if(n instanceof Array&&(n.length>1?(o=M.utils.isNullOrEmpty(n[1])||M.utils.isNullOrEmpty(n[1].getImage())||!n[1].getImage().getGlyph?null:n[1].getImage(),n=!M.utils.isNullOrEmpty(n[1].getImage())&&n[1].getImage().getSrc?n[1]:n[0]):n=n[0]),!M.utils.isNullOrEmpty(n)){var s,E=n.getImage(),x=M.utils.isNullOrEmpty(E)?[0,0]:E.getImageSize()||[24,24],S=n.getText();M.utils.isNullOrEmpty(S)&&!M.utils.isNullOrEmpty(n.textPath)&&(S=n.textPath),s="multipolygon"===i.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===i.getGeometry().getType().toLowerCase()?"point":"multilinestring"===i.getGeometry().getType().toLowerCase()?"line":i.getGeometry().getType().toLowerCase();var N,L=M.utils.isNullOrEmpty(E)?n.getStroke():E.getStroke&&E.getStroke(),C=M.utils.isNullOrEmpty(E)?n.getFill():E.getFill&&E.getFill(),T=M.utils.isNullOrEmpty(E)?"":E.getRadius&&E.getRadius(),w={type:s,fillColor:M.utils.isNullOrEmpty(C)?"#000000":M.utils.rgbaToHex(C.getColor()).slice(0,7),fillOpacity:M.utils.isNullOrEmpty(C)?0:M.utils.getOpacityFromRgba(C.getColor()),strokeColor:M.utils.isNullOrEmpty(L)?"#000000":M.utils.rgbaToHex(L.getColor()),strokeOpacity:M.utils.isNullOrEmpty(L)?0:M.utils.getOpacityFromRgba(L.getColor()),strokeWidth:M.utils.isNullOrEmpty(L)?0:L.getWidth&&L.getWidth(),pointRadius:M.utils.isNullOrEmpty(E)?"":E.getRadius&&E.getRadius(),externalGraphic:M.utils.isNullOrEmpty(E)?"":E.getSrc&&E.getSrc(),graphicHeight:x[0],graphicWidth:x[1]};Number.isNaN(T)&&(w.fillOpacity=0,w.strokeOpacity=0,w.pointRadius=0);var F=!M.utils.isNullOrEmpty(o)&&o.getImage?o.getImage():null;if(M.utils.isNullOrEmpty(F)||(o.getRadius&&o.getRadius()&&(w.pointRadius=o.getRadius&&o.getRadius()),o.getOpacity&&o.getOpacity()&&(w.graphicOpacity=o.getOpacity()),w.externalGraphic=F.toDataURL()),!M.utils.isNullOrEmpty(S)){var P=S.getTextAlign(),R=S.getTextBaseline(),k="";M.utils.isNullOrEmpty(P)||(P=P===M.style.align.LEFT?"l":P===M.style.align.RIGHT?"r":P===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(R)||(R=R===M.style.baseline.BOTTOM?"b":R===M.style.baseline.MIDDLE?"m":R===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(P)||M.utils.isNullOrEmpty(R)||(k=P.concat(R));var A=S.getFont(),j=!M.utils.isNullOrEmpty(A)&&A.indexOf("bold")>-1?"bold":"normal",I="11px";if(!M.utils.isNullOrEmpty(A)){var D=A.substr(0,A.indexOf("px"));if(!M.utils.isNullOrEmpty(D)){var G=D.lastIndexOf(" ");I=G>-1?D.substr(G,D.length).trim().concat("px"):D.concat("px")}}N={type:"text",label:S.getText()||"",fontColor:M.utils.isNullOrEmpty(S.getFill())?"#000000":M.utils.rgbToHex(S.getFill().getColor()),fontSize:I,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:j,conflictResolution:e.additionalOptsLabel_.conflictResolution,labelXOffset:S.getOffsetX(),labelYOffset:S.getOffsetY(),fillColor:w.fillColor||"#FF0000",fillOpacity:w.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(S.getStroke())?"":M.utils.rgbToHex(S.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(S.getStroke())?"":S.getStroke().getWidth(),labelAlign:k},N=e.addAdditionalLabelOptions(N)}if(f="draw".concat(g),!M.utils.isNullOrEmpty(l)&&l.intersectsExtent(p)||!M.utils.isNullOrEmpty(S)){var W,U=JSON.stringify(w),q=JSON.stringify(N),z=O[U],H=_[q];if(M.utils.isUndefined(z)||M.utils.isUndefined(H)){var B=[],J=0;if(!M.utils.isNullOrEmpty(l)&&l.intersectsExtent(p)&&M.utils.isUndefined(z)&&(z=v,O[U]=z,J=1,B.push(U),v+=1,g+=1),!M.utils.isNullOrEmpty(S)&&M.utils.isUndefined(H)&&(H=h,_[q]=H,B.push(q),h+=1,0===J&&(g+=1,B.push(U))),void 0===z&&(z=0),void 0===H&&(H=0),d="\"[_gx_style ='".concat(z+H,"']\""),!M.utils.isNullOrEmpty(B)){var V=" ".concat(d,':{"symbolizers": [').concat(B,"]}");if(t.getStyle()instanceof M.style.Proportional){var X=i.getGeometry().getType().toLocaleLowerCase();X.indexOf("polygon")>=0?V=V.replace("polygon","point"):X.indexOf("line")>=0&&(V=V.replace("line","point"))}V=V.replace("linestring","line"),b+=""!==b?",".concat(V):"{".concat(V,',"version":"2"')}}(W="EPSG:3857"!==r.code&&e.facadeMap_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))?c.writeFeatureObject(i,{featureProjection:r.code,dataProjection:"EPSG:3857"}):c.writeFeatureObject(i)).properties={_gx_style:z+H,name:f},y.push(W)}}}),this),i={type:"Vector",style:b=""!==b?JSON.parse(b.concat("}")):{"*":{symbolizers:[]},version:"2"},geoJson:{type:"FeatureCollection",features:y},name:o,opacity:s}}return i}},{key:"encodeMVT",value:function(t){var e=this,i=null,n=!0;if((t.getStyle()instanceof M.style.Chart||t.getStyle()instanceof M.style.Cluster&&t.getStyle().getOldStyle()instanceof M.style.Chart)&&(n=!1),n){var r=this.facadeMap_.getProjection(),l=t.getImpl().getOL3Layer(),a=t.getFeatures(),o=t.name,s=l.getOpacity(),u=l.getStyle(),c=new ol.format.GeoJSON,p=this.facadeMap_.getBbox();p=[p.x.min,p.y.min,p.x.max,p.y.max];var f,d,m=this.facadeMap_.getMapImpl().getView().getResolution(),y=[],g=1,h=1,v=1,b="",O={},_={};a.forEach((function(t){var i,n=t.getGeometry(),l=t.getStyle();if(M.utils.isNullOrEmpty(l)?M.utils.isNullOrEmpty(u)||(i=u):i=l,i instanceof Function&&(i=i.call(i,t,m)),i instanceof Array&&(i=i.length>1&&!M.utils.isNullOrEmpty(i[1].getImage())&&i[1].getImage().getSrc?i[1]:i[0]),!M.utils.isNullOrEmpty(i)){var a,o=i.getImage(),s=M.utils.isNullOrEmpty(o)?[0,0]:o.getImageSize()||[24,24],E=i.getText();M.utils.isNullOrEmpty(E)&&!M.utils.isNullOrEmpty(i.textPath)&&(E=i.textPath),a="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":"multilinestring"===t.getGeometry().getType().toLowerCase()?"line":t.getGeometry().getType().toLowerCase();var x,S=M.utils.isNullOrEmpty(o)?i.getStroke():o.getStroke&&o.getStroke(),N=M.utils.isNullOrEmpty(o)?i.getFill():o.getFill&&o.getFill(),L={type:a,fillColor:M.utils.isNullOrEmpty(N)?"#000000":M.utils.rgbaToHex(N.getColor()).slice(0,7),fillOpacity:M.utils.isNullOrEmpty(N)?0:M.utils.getOpacityFromRgba(N.getColor()),strokeColor:M.utils.isNullOrEmpty(S)?"#000000":M.utils.rgbaToHex(S.getColor()),strokeOpacity:M.utils.isNullOrEmpty(S)?0:M.utils.getOpacityFromRgba(S.getColor()),strokeWidth:M.utils.isNullOrEmpty(S)?0:S.getWidth&&S.getWidth(),pointRadius:M.utils.isNullOrEmpty(o)?"":o.getRadius&&o.getRadius(),externalGraphic:M.utils.isNullOrEmpty(o)?"":o.getSrc&&o.getSrc(),graphicHeight:s[0],graphicWidth:s[1]};if(!M.utils.isNullOrEmpty(E)){var C=E.getTextAlign(),T=E.getTextBaseline(),w="";M.utils.isNullOrEmpty(C)||(C=C===M.style.align.LEFT?"l":C===M.style.align.RIGHT?"r":C===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(T)||(T=T===M.style.baseline.BOTTOM?"b":T===M.style.baseline.MIDDLE?"m":T===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(C)||M.utils.isNullOrEmpty(T)||(w=C.concat(T));var F=E.getFont(),P=!M.utils.isNullOrEmpty(F)&&F.indexOf("bold")>-1?"bold":"normal",R="11px";if(!M.utils.isNullOrEmpty(F)){var k=F.substr(0,F.indexOf("px"));if(!M.utils.isNullOrEmpty(k)){var A=k.lastIndexOf(" ");R=A>-1?k.substr(A,k.length).trim().concat("px"):k.concat("px")}}x={type:"text",label:E.getText()||"",fontColor:M.utils.isNullOrEmpty(E.getFill())?"#000000":M.utils.rgbToHex(E.getFill().getColor()),fontSize:R,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:P,conflictResolution:e.additionalOptsLabel_.conflictResolution,labelXOffset:E.getOffsetX(),labelYOffset:E.getOffsetY(),fillColor:L.fillColor||"#FF0000",fillOpacity:L.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(E.getStroke())?"":M.utils.rgbToHex(E.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(E.getStroke())?"":E.getStroke().getWidth(),labelAlign:w},x=e.addAdditionalLabelOptions(x)}if(f="draw".concat(g),!M.utils.isNullOrEmpty(n)&&n.intersectsExtent(p)||!M.utils.isNullOrEmpty(E)){var j,I=JSON.stringify(L),D=JSON.stringify(x),G=O[I],W=_[D];if(M.utils.isUndefined(G)||M.utils.isUndefined(W)){var U=[],q=0;if(!M.utils.isNullOrEmpty(n)&&n.intersectsExtent(p)&&M.utils.isUndefined(G)&&(G=v,O[I]=G,q=1,U.push(I),v+=1,g+=1),!M.utils.isNullOrEmpty(E)&&M.utils.isUndefined(W)&&(W=h,_[D]=W,U.push(D),h+=1,0===q&&(g+=1,U.push(I))),void 0===G&&(G=0),void 0===W&&(W=0),d="\"[_gx_style ='".concat(G+W,"']\""),!M.utils.isNullOrEmpty(U)){var z=" ".concat(d,':{"symbolizers": [').concat(U,"]}");b+=""!==b?",".concat(z):"{".concat(z,',"version":"2"')}}(j="EPSG:3857"!==r.code&&e.facadeMap_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))?c.writeFeatureObject(t,{featureProjection:r.code,dataProjection:"EPSG:3857"}):c.writeFeatureObject(t)).properties={_gx_style:G+W,name:f},y.push(j)}}}),this),i={type:"Vector",style:b=""!==b?JSON.parse(b.concat("}")):{"*":{symbolizers:[]},version:"2"},geoJson:{type:"FeatureCollection",features:y},name:o,opacity:s}}return i}},{key:"encodeWMTS",value:function(t){var e=this.facadeMap_.getZoom(),i=t.getImpl(),n=i.getOL3Layer(),r=n.getSource(),l=r.getTileGrid(),a=M.utils.isNullOrEmpty(r.getStyle)?"default":r.getStyle(),o=t.url,s=t.name,u=n.getOpacity(),c=r.getRequestEncoding(),p=i.tiled,f=n.getExtent(),d={},m=r.getMatrixSet(),y=l.getTileSize(e),g=l.getResolutions();return t.getImpl().getCapabilities().then((function(t){var e=t.Contents.TileMatrixSet.filter((function(t){return t.Identifier===m}))[0];return{baseURL:o,opacity:u,singleTile:!p,type:"WMTS",layer:s,requestEncoding:c,tileSize:y,style:M.utils.isNullOrEmpty(a)?"default":a,rotation:0,imageFormat:"image/png",dimensionParams:{},dimensions:[],params:d,version:"1.0.0",maxExtent:f,matrixSet:m,matrices:e.TileMatrix.map((function(t,e){return{identifier:t.Identifier,matrixSize:[t.MatrixHeight,t.MatrixWidth],scaleDenominator:t.ScaleDenominator,tileSize:[t.TileWidth,t.TileHeight],topLeftCorner:t.TopLeftCorner}})),resolutions:g}}))}},{key:"encodeOSM",value:function(t){var e=t.getImpl(),i=e.getOL3Layer(),n=i.getSource().getTileGrid(),r=t.url||"http://tile.openstreetmap.org/",l=t.name,a=i.getOpacity(),o=e.tiled,s=n.getExtent(),u=n.getTileSize();return{baseURL:r,opacity:a,singleTile:!o,layer:l,maxExtent:s,tileSize:[u,u],resolutions:n.getResolutions(),type:"OSM",imageExtension:"png"}}},{key:"encodeMapbox",value:function(t){var e=t.getImpl().getOL3Layer(),i=e.getSource().getTileGrid(),n=M.utils.concatUrlPaths([M.config.MAPBOX_URL,t.name]),r=e.getOpacity(),l=i.getExtent(),a=i.getTileSize(),o=i.getResolutions(),s={};return s[M.config.MAPBOX_TOKEN_NAME]=M.config.MAPBOX_TOKEN_VALUE,{opacity:r,baseURL:n,customParams:s,maxExtent:l,tileSize:[a,a],resolutions:o,extension:M.config.MAPBOX_EXTENSION,type:"osm",path_format:"/${z}/${x}/${y}.png"}}},{key:"transformExt",value:function(t,e,i){return ol.proj.transformExtent(t,e,i)}},{key:"addAdditionalLabelOptions",value:function(t){var e=t;return M.utils.isNullOrEmpty(this.additionalOptsLabel_.allowOverruns)||(e.allowOverruns=this.additionalOptsLabel_.allowOverruns),M.utils.isNullOrEmpty(this.additionalOptsLabel_.autoWrap)||(e.autoWrap=this.additionalOptsLabel_.autoWrap),M.utils.isNullOrEmpty(this.additionalOptsLabel_.followLine)||(e.followLine=this.additionalOptsLabel_.followLine),M.utils.isNullOrEmpty(this.additionalOptsLabel_.goodnessOfFit)||(e.goodnessOfFit=this.additionalOptsLabel_.goodnessOfFit),M.utils.isNullOrEmpty(this.additionalOptsLabel_.group)||(e.group=this.additionalOptsLabel_.group),M.utils.isNullOrEmpty(this.additionalOptsLabel_.maxDisplacement)||(e.maxDisplacement=this.additionalOptsLabel_.maxDisplacement),M.utils.isNullOrEmpty(this.additionalOptsLabel_.spaceAround)||(e.spaceAround=this.additionalOptsLabel_.spaceAround),e}},{key:"setGoodnessOfFit",value:function(t){this.additionalOptsLabel_.goodnessOfFit=t}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null}}])&&l(e.prototype,i),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(),d=i(0),m=i.n(d);function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=O(t);if(e){var r=O(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return b(this,i)}}function b(t,e){if(e&&("object"===y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _="No se ha podido conectar con el servicio de impresión",E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(l,M.Control);var e,i,n,r=v(l);function l(t,e,i){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l);var a=new f(i);return n=r.call(this,a,l.NAME),M.utils.isUndefined(f)&&M.exception("La implementación usada no puede crear controles Geoprint"),M.utils.isUndefined(f.prototype.encodeLayer)&&M.exception("La implementación usada no posee el método encodeLayer"),M.utils.isUndefined(f.prototype.encodeLegend)&&M.exception("La implementación usada no posee el método encodeLegend"),n.url_=t,n.ref_=null,n.printing_=!1,n.jsonDatasource=[],n.inputTitulo_=null,n.areaDescription_=null,n.inputExpediente_=null,n.inputLocalizacion=null,n.inputSuperficie=null,n.inputFirmante1=null,n.inputFirmante2=null,n.inputFirmante3=null,n.inputFirmante4=null,n.inputCargo1=null,n.inputCargo2=null,n.inputCargo3=null,n.inputCargo4=null,n.layout_=null,n.format_=null,n.dpi_=null,n.forceScale_=null,n.textWrap_=null,n.params_=e||{},n.queueContainer_=null,n.capabilitiesPromise_=null,n.connectionTimeout_=i.connectionTimeout||15,n.loadingService=!0,n.errorService=!1,n.outputFormats_=Array.isArray(i.outputFormats)?i.outputFormats:["pdf","png","jpg"],n.options_=i||{},M.utils.isNullOrEmpty(n.options_.layout)&&(n.options_.layout=M.config.geoprint.TEMPLATE),M.utils.isNullOrEmpty(n.options_.dpi)&&(n.options_.dpi=M.config.geoprint.DPI),M.utils.isNullOrEmpty(n.options_.format)&&(n.options_.format=M.config.geoprint.FORMAT),M.utils.isNullOrEmpty(n.options_.forceScale)&&(n.options_.forceScale=M.config.geoprint.FORCE_SCALE),M.utils.isNullOrEmpty(n.options_.legend)&&(n.options_.legend=M.config.geoprint.LEGEND),M.utils.isNullOrEmpty(n.options_.labeling)?n.options_.labeling={goodnessOfFit:.9}:M.utils.isNullOrEmpty(n.options_.labeling.goodnessOfFit)&&(n.options_.labeling.goodnessOfFit=.9),n}return e=l,(i=[{key:"getStatus",value:function(t,e){var i=this;M.remote.get(t).then((function(n){var r=JSON.parse(n.text).status;"finished"===r?e():"error"===r?(e(),M.dialog.error("Se ha producido un error en la impresión")):!1===i.printing_?(M.dialog.error("Se ha cancelado la impresión"),i.queueContainer_.lastChild.remove()):setTimeout((function(){return i.getStatus(t,e)}),1e3)}))}},{key:"open",value:function(){if(this.loadingService)M.dialog.error("El servicio aún no ha cargado","Servicio cargando");else if(this.errorService)M.dialog.error(_,"Error de conexión");else{var t=this.getPanel().getTemplatePanel(),e=this.getPanel().getButtonPanel();t.classList.remove("collapsed"),e.classList.remove("g-cartografia-impresora"),t.classList.add("opened"),e.classList.add("g-cartografia-flecha-derecha"),this.getPanel().setCollapsed(!1),this.getPanel().fire(M.evt.SHOW)}}},{key:"createView",value:function(t){var e=this;return this.getPanel().open=this.open.bind(this),new Promise((function(t,i){e.getCapabilities().then((function(i){var n,r,l=i,a=0;for(l.layouts=l.layouts.filter((function(t){return!t.name.endsWith("jpg")})),a=0,n=l.layouts.length;a<n;a+=1){var o=l.layouts[a];if(o.name===e.options_.layout){o.default=!0;break}}for(l.dpis=[],a=0,n=l.layouts[0].attributes.length;a<n;a+=1)null!=l.layouts[0].attributes[a].clientInfo&&(r=l.layouts[0].attributes[a]);for(a=0,n=r.clientInfo.dpiSuggestions.length;a<n;a+=1){var s=r.clientInfo.dpiSuggestions[a],u={value:s};s===e.options_.dpi&&(u.default=!0),l.dpis.push(u)}Array.isArray(l.formats)&&(e.outputFormats_=l.formats),l.format=e.outputFormats_.map((function(t){var i={name:t};return t===e.options_.format&&(i.default=!0),i})),M.template.compileSync||(M.template.compileSync=function(t,e){var i,n={};M.utils.isUndefined(e)||(n=M.utils.extends(n,e.vars),i=e.parseToHtml);var r=Handlebars.compile(t)(n);return!1!==i?M.utils.stringToHtml(r):r}),l.forceScale=e.options_.forceScale,l.textWrap=e.options_.labeling.goodnessOfFit,l.firmante1=l.layouts[0].attributes.find((function(t){return"firmante1"===t.name})).default,l.labelFirmante1=l.layouts[0].attributes.find((function(t){return"labelFirmante1"===t.name})).default,l.firmante2=l.layouts[0].attributes.find((function(t){return"firmante2"===t.name})).default,l.labelFirmante2=l.layouts[0].attributes.find((function(t){return"labelFirmante2"===t.name})).default,l.firmante3=l.layouts[0].attributes.find((function(t){return"firmante3"===t.name})).default,l.labelFirmante3=l.layouts[0].attributes.find((function(t){return"labelFirmante3"===t.name})).default,l.firmante4=l.layouts[0].attributes.find((function(t){return"firmante4"===t.name})).default,l.labelFirmante4=l.layouts[0].attributes.find((function(t){return"labelFirmante4"===t.name})).default,l.cargo1=l.layouts[0].attributes.find((function(t){return"cargo1"===t.name})).default,l.labelCargo1=l.layouts[0].attributes.find((function(t){return"labelCargo1"===t.name})).default,l.cargo2=l.layouts[0].attributes.find((function(t){return"cargo2"===t.name})).default,l.labelCargo2=l.layouts[0].attributes.find((function(t){return"labelCargo2"===t.name})).default,l.cargo3=l.layouts[0].attributes.find((function(t){return"cargo3"===t.name})).default,l.labelCargo3=l.layouts[0].attributes.find((function(t){return"labelCargo3"===t.name})).default,l.cargo4=l.layouts[0].attributes.find((function(t){return"cargo4"===t.name})).default,l.labelCargo4=l.layouts[0].attributes.find((function(t){return"labelCargo4"===t.name})).default;var c=M.template.compileSync(m.a,{jsonp:!0,vars:l});e.addEvents(c);var p=e.map_.getLayers(),f=c.querySelector("#multiSel"),d=document.createElement("DIV");d.setAttribute("class","selectBox"),d.addEventListener("click",(function(t){var e=document.getElementById("checkboxes");e.classList.contains("hide")?e.classList.remove("hide"):e.classList.add("hide")}));var y=document.createElement("select"),g=document.createElement("option");g.innerHTML="Leyenda capas activas",document.createElement("DIV").setAttribute("class","overSelect"),y.appendChild(g),d.appendChild(y);var h=document.createElement("DIV");h.setAttribute("class","hide"),h.setAttribute("id","checkboxes"),f.appendChild(d),f.appendChild(h),p.forEach((function(t){if(null!=t.legend){var e=document.createElement("INPUT");e.setAttribute("type","checkbox"),e.setAttribute("value","valor_checkbox"),e.setAttribute("id",t.name),e.setAttribute("class","checkboxLegend"),e.setAttribute("title",t.legend),e.setAttribute("checked","checked");var i=document.createElement("label");i.setAttribute("htmlFor",t.name),i.setAttribute("class","nombreCapa"),i.appendChild(document.createTextNode(t.legend)),i.appendChild(e),h.appendChild(i)}})),e.loadingService=!1,t(c)})).catch((function(t){e.loadingService=!1,e.errorService=!0,M.dialog.error(_,"Error de conexión")}))}))}},{key:"addEvents",value:function(t){var e=this;this.element_=t,this.inputTitulo_=this.element_.querySelector(".form div.titulo > input"),this.areaDescription_=this.element_.querySelector(".form div.subtitulo > input"),this.inputExpediente_=this.element_.querySelector(".form div.expediente > input"),this.inputLocalizacion=this.element_.querySelector(".form div.localizacion > input"),this.inputSuperficie=this.element_.querySelector(".form div.superficie > input"),this.inputFirmante1=this.element_.querySelector(".form div.firmante1 > input"),this.inputFirmante2=this.element_.querySelector(".form div.firmante2 > input"),this.inputFirmante3=this.element_.querySelector(".form div.firmante3 > input"),this.inputFirmante4=this.element_.querySelector(".form div.firmante4 > input"),this.inputCargo1=this.element_.querySelector(".form div.cargo1 > input"),this.inputCargo2=this.element_.querySelector(".form div.cargo2 > input"),this.inputCargo3=this.element_.querySelector(".form div.cargo3 > input"),this.inputCargo4=this.element_.querySelector(".form div.cargo4 > input");var i=this.element_.querySelector(".form div.layout > select");i.addEventListener("change",(function(t){var n=i.value;e.setLayout({value:n,name:n})}));var n=i.value;this.setLayout({value:n,name:n});var r=this.element_.querySelector(".form div.dpi > select");r.addEventListener("change",(function(t){var i=r.value;e.setDpi({value:i,name:i})}));var l=r.value;this.setDpi({value:l,name:l});var a=this.element_.querySelector(".form div.format > select");a.addEventListener("change",(function(t){e.setFormat(a.value)})),this.setFormat(a.value);var o=this.element_.querySelector(".form div.forcescale > input");o.addEventListener("click",(function(t){e.setForceScale(!0===o.checked)})),this.setForceScale(!0===o.checked);var s=this.element_.querySelector(".form div.textwrap > input");s.addEventListener("change",(function(t){e.setTextWrap(parseFloat(s.value))})),this.element_.querySelector(".button > button.print").addEventListener("click",this.printClick_.bind(this)),this.element_.querySelector(".button > button.cancel").addEventListener("click",this.cancelClick_.bind(this)),this.element_.querySelector(".button > button.remove").addEventListener("click",(function(t){t.preventDefault(),e.inputTitulo_.value="",e.areaDescription_.value="",e.inputExpediente_.value="",e.inputLocalizacion.value="",e.inputSuperficie.value="",e.inputFirmante1.value="",e.inputFirmante2.value="",e.inputFirmante3.value="",e.inputFirmante4.value="",e.inputCargo1.value="",e.inputCargo2.value="",e.inputCargo3.value="",e.inputCargo4.value="",i.value=e.options_.layout,r.value=e.options_.dpi,a.value=e.options_.format,o.checked=e.options_.forceScale,s.value=e.options_.labeling.textWrap;var n=document.createEvent("HTMLEvents");n.initEvent("change");var l=document.createEvent("HTMLEvents");l.initEvent("click"),i.dispatchEvent(n),r.dispatchEvent(n),a.dispatchEvent(n),o.dispatchEvent(l),s.dispatchEvent(n),Array.prototype.forEach.apply(e.queueContainer_.children,[function(t){t.removeEventListener("click",e.dowloadPrint)},e]),e.queueContainer_.innerHTML=""})),this.queueContainer_=this.element_.querySelector(".queue > ul.queue-container"),M.utils.enableTouchScroll(this.queueContainer_)}},{key:"setLayout",value:function(t){this.layout_=t}},{key:"setFormat",value:function(t){this.format_=t}},{key:"setDpi",value:function(t){this.dpi_=t}},{key:"setForceScale",value:function(t){this.forceScale_=t}},{key:"setTextWrap",value:function(t){this.textwrap_=t,this.getImpl().setGoodnessOfFit(t);var e=this.getPanel().getTemplatePanel(),i=e.querySelector("#label"),n=e.querySelector("#inputRange");i.innerHTML=n.value}},{key:"printClick_",value:function(t){var e=this;if(this.jsonDatasource=[],t.preventDefault(),void 0!==parent[0].datosMensaje.data||void 0!==parent[0].datosMensaje.intermediateUrls){var i=parent[0].datosMensaje.intermediateUrls,n="";i.forEach((function(t){n=t.url,n+=t.search.searchUrlPart,n+="<Filter><PropertyIsEqualTo><PropertyName>"+t.search.codeNameToUse+"</PropertyName><Literal>"+t.search.searchData[0]+"</Literal></PropertyIsEqualTo></Filter>"})),M.remote.get(n).then((function(t){var i=JSON.parse(t.text);""!=i&&null!=i&&i.features.forEach((function(t){var i={};i.title=t.properties.T_IDENTIFICACION,i.table={columns:["Coordenada X","Coordenada Y"],data:[]};var n,r=null,l=0,a=0,o=[],s=[];r=t.geometry.coordinates[0][0],t.geometry.coordinates[0].forEach((function(t){t[0]<r[0]&&(r=t,l=a),a++})),o=t.geometry.coordinates[0].slice(l,t.geometry.coordinates[0].length),n=t.geometry.coordinates[0].slice(0,l),(s=o.concat(n)).forEach((function(t){i.table.data.push(t)})),console.log("Array Auxiliar",s),console.log("Datos que meter",i),e.jsonDatasource.push(i)})),e.getPrintData().then((function(t){var i=M.utils.concatUrlPaths([e.url_,"report.".concat(t.outputFormat)]),n=e.createQueueElement();e.queueContainer_.appendChild(n),n.classList.add(l.LOADING_CLASS),i=M.utils.addParameters(i,"mapeaop=geoprint"),M.proxy(!1),M.remote.post(i,t).then((function(t){var i=t,r=JSON.parse(i.text);e.ref_=r.ref;var a=M.utils.concatUrlPaths([e.params_.urlApplication,"print/status","".concat(e.ref_,".json")]);if(e.printing_=!0,e.getStatus(a,(function(){return n.classList.remove(l.LOADING_CLASS)})),200===i.code){var o;try{var s=(i=JSON.parse(i.text)).downloadURL.split("@")[1],u=i.downloadURL.substring(i.downloadURL.indexOf("/print"),i.downloadURL.length);o=M.utils.concatUrlPaths([e.params_.urlApplication,"".concat(u,";GEOPRID=.").concat(s)])}catch(t){M.exception(t)}n.setAttribute(l.DOWNLOAD_ATTR_NAME,o),n.addEventListener("click",e.dowloadPrint)}else M.dialog.error("Se ha producido un error en la impresión")}))}))}))}else M.dialog.error("Porfavor espere a que se cargue el mapa.")}},{key:"cancelClick_",value:function(t){t.preventDefault(),this.printing_=!1}},{key:"getCapabilities",value:function(){var t=this;return M.proxy(!1),M.utils.isNullOrEmpty(this.capabilitiesPromise_)&&(this.capabilitiesPromise_=new Promise((function(e,i){setTimeout((function(){var t=new Error("CONNECTION TIMEOUT");i(t)}),1e3*t.connectionTimeout_);var n=M.utils.concatUrlPaths([t.url_,"capabilities.json"]);M.remote.get(n).then((function(t){var i={};try{i=JSON.parse(t.text)}catch(t){M.exception(t)}e(i)}))}))),this.capabilitiesPromise_}},{key:"getPrintData",value:function(){var t=this,e=this.inputTitulo_.value,i=this.areaDescription_.value,n=this.inputExpediente_.value,r=this.inputLocalizacion.value,l=this.inputSuperficie.value,a=this.inputFirmante1.value,o=this.inputFirmante2.value,s=this.inputFirmante3.value,u=this.inputFirmante4.value,c=this.inputCargo1.value,p=this.inputCargo2.value,f=this.inputCargo3.value,d=this.inputCargo4.value,m=this.map_.getProjection().code,y=this.layout_.name,g=this.dpi_.value,h=this.format_,v=this.map_.getCenter(),b=this.params_.parameters,O=this.options_.legend,_="";_=this.jsonDatasource.length>0&&null!=this.jsonDatasource&&null!=this.jsonDatasource&&""!=this.jsonDatasource?this.jsonDatasource:[{title:"Sin datos de coordenadas.",table:{columns:[],data:[]}}],"jpg"===h&&(y+=" jpg");var E=M.utils.extend({layout:y,srs:m,outputFormat:h,attributes:{title:e,description:i,expediente:n,localizacion:r,superficie:l,firmante1:a,firmante2:o,firmante3:s,firmante4:u,cargo1:c,cargo2:p,cargo3:f,cargo4:d,epsg:m,map:{useAdjustBounds:!0,projection:m,dpi:g},datasource:_}},this.params_.layout);return this.encodeLayers().then((function(e){E.attributes.map.layers=e,E.attributes=Object.assign(E.attributes,b);var i=document.getElementsByClassName("checkboxLegend"),n=Array.from(i);if(O&&function(){for(var e=[],i=t.encodeLegends(),r=function(t,r){if(!M.utils.isNullOrEmpty(i[t].classes[0])){var l={name:i[t].classes[0].name,icons:i[t].classes[0].icons};null!=n&&n.length>0&&n.forEach((function(n){n.id===i[t].classes[0].name&&!0===n.checked&&e.push(l)}))}},l=0,a=i.length;l<a;l+=1)r(l);E.attributes.legend={classes:e}}(),"EPSG:3857"!==m&&t.map_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))&&(E.attributes.map.projection="EPSG:3857"),!1===t.forceScale_){var r=t.map_.getBbox();E.attributes.map.bbox=[r.x.min,r.y.min,r.x.max,r.y.max],"EPSG:3857"!==m&&t.map_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))&&(E.attributes.map.bbox=t.getImpl().transformExt(E.attributes.map.bbox,m,"EPSG:3857"))}else!0===t.forceScale_&&(E.attributes.map.center=[v.x,v.y],E.attributes.map.scale=t.map_.getScale());return E}))}},{key:"encodeLayers",value:function(){var t=this,e=this.map_.getLayers().filter((function(t){return!0===t.isVisible()&&!0===t.inRange()&&M.utils.isString(t.name)&&!t.name.startsWith("cluster_cover")})),i=e.length;return new Promise((function(n,r){var l=[],a=[];e.forEach((function(e){t.getImpl().encodeLayer(e).then((function(r){if(M.utils.isNullOrEmpty(r)||"Vector"===r.type){var o=t.map_.getMapImpl().getView().getResolution(),s=e.getImpl().getOL3Layer().getMaxResolution();o>=e.getImpl().getOL3Layer().getMinResolution()&&o<=s&&a.push(r)}else l.push(r);0==(i-=1)&&(l=l.concat(a),n(l.reverse()))}))}))}))}},{key:"encodeLegends",value:function(){var t=this,e=[];return this.map_.getLayers().forEach((function(i){if(!0===i.isVisible()&&!0===i.inRange()){var n=t.getImpl().encodeLegend(i);null!==n&&e.push(n)}}),this),e}},{key:"createQueueElement",value:function(){var t=document.createElement("li"),e=this.inputTitulo_.value;return M.utils.isNullOrEmpty(e)&&(e=l.NO_TITLE),t.innerHTML=e,t}},{key:"dowloadPrint",value:function(t){t.preventDefault();var e=this.getAttribute(l.DOWNLOAD_ATTR_NAME);M.utils.isNullOrEmpty(e)||window.open(e,"_blank")}},{key:"equals",value:function(t){var e=!1;return t instanceof l&&(e=this.name===t.name),e}}])&&g(e.prototype,i),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),l}();E.NAME="GeoprintControl",E.TEMPLATE="geoprint.html",E.LOADING_CLASS="printing",E.DOWNLOAD_ATTR_NAME="data-donwload-url-print",E.NO_TITLE="(Sin título)";var x=i(1);function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function C(t,e){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=F(t);if(e){var r=F(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return w(this,i)}}function w(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&C(t,e)}(l,M.Plugin);var e,i,n,r=T(l);function l(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return N(this,l),(t=r.call(this,null)).map_=null,t.control_=null,t.panel_=null,t.name=l.NAME,M.utils.isUndefined(M.config.geoprint2)&&M.config("geoprint2",{URL:"http://10.140.88.78:8082/print/siglitoral",URL_APPLICATION:"http://10.140.88.78:8082/print/"}),t.url_=M.config.geoprint2.URL,M.utils.isNullOrEmpty(e.url)||(t.url_=e.url),t.params_={urlApplication:M.config.geoprint2.URL_APPLICATION,layout:{outputFilename:"mapea_${yyyy-MM-dd_hhmmss}"}},M.utils.isNullOrEmpty(e.params)||(t.params_=e.params,M.utils.isNullOrEmpty(t.params_.urlApplication)&&(t.params_.urlApplication=M.config.geoprint2.URL_APPLICATION),M.utils.isNullOrEmpty(t.params_.layout)&&(t.params_.layout={outputFilename:"mapea_${yyyy-MM-dd_hhmmss}"})),t.options_={},M.utils.isNullOrEmpty(e.options)||(t.options_=e.options),t.metadata_=x.metadata,t}return e=l,(i=[{key:"addTo",value:function(t){var e=this;this.map_=t,this.control_=new E(this.url_,this.params_,this.options_),this.panel_=new M.ui.Panel("Geoprint",{collapsible:!0,className:"m-geoprint",collapsedButtonClass:"g-cartografia-impresora",position:M.ui.position.TR,tooltip:"Impresión del mapa"}),this.panel_.on(M.evt.ADDED_TO_MAP,(function(t){M.utils.enableTouchScroll(t)})),this.panel_.addControls(this.control_),this.map_.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,(function(){e.fire(M.evt.ADDED_TO_MAP)}))}},{key:"getControls",value:function(){var t=[];return t.push(this.control_),t}},{key:"destroy",value:function(){this.map_.removeControls([this.control_]),this.map_=null,this.control_=null,this.panel_=null,this.url_=null,this.params_=null,this.options_=null,this.name=null}},{key:"equals",value:function(t){return t instanceof l}},{key:"getAPIRest",value:function(){return"Geoprint=".concat(this.url_)}},{key:"getMetadata",value:function(){return this.metadata_}}])&&L(e.prototype,i),n&&L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),l}();P.NAME="Geoprint",window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Geoprint=P,window.M.control.GeoprintControl=E,window.M.impl.control.GeoprintControl=f}]);
//# sourceMappingURL=geoprint.ol.min.js.map